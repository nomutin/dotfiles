" >>> `curl -s https://raw.githubusercontent.com/nomutin/dotfiles/master/config/vimrc -o ~/.vimrc`

" ===== Builtin =====
set encoding=utf-8
unlet! skip_defaults_vim
source $VIMRUNTIME/defaults.vim
set autoread hidden
set background=dark
set clipboard=unnamed
set completeopt=menuone,noinsert,noselect pumheight=10
set cursorline
set expandtab tabstop=4 shiftwidth=4
set hlsearch incsearch ignorecase smartcase
set list listchars=tab:>\ ,trail:-,extends:>,precedes:<,nbsp:+
set runtimepath^=~/.vim
set noswapfile
set undofile undodir=~/.vim/undo | call mkdir($HOME.'/.vim/undo', 'p')
set viminfo=

inoremap <silent> jk <Esc>
nnoremap <C-l> <CMD>nohlsearch<CR><Esc>
nnoremap <space>d <CMD>new<BAR>exec 'read !git show HEAD:#'<BAR>setl bt=nofile ro<BAR>difft<BAR>winc p<BAR>difft<CR>

" ===== Plugin =====
if empty(glob('~/.vim/plugged'))
    let plug_url = 'https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
    silent execute '!curl -fLo ~/.vim/autoload/plug.vim --create-dirs '.plug_url
endif

call plug#begin('~/.vim/plugged')
    Plug 'noahfrederick/vim-noctu'
    Plug 'tpope/vim-commentary'
    Plug 'preservim/nerdtree'
        nnoremap <space>n <CMD>NERDTreeToggle<CR>
    Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
    Plug 'junegunn/fzf.vim'
        let $FZF_DEFAULT_COMMAND = 'rg --files --hidden --follow --glob "!.git/*"'
        nnoremap <space>f <CMD>Files<CR>
        nnoremap <space>/ <CMD>Rg<CR>
    Plug 'natebosch/vim-lsc'
        nnoremap <space>e <CMD>LSClientAllDiagnostics<CR>
        inoremap <C-S> <CMD>LSClientSignatureHelp<CR>
        let g:lsc_auto_map = {'defaults': v:true, 'FindReferences': 'grr', 'Rename': 'grn'}
        let g:lsc_server_commands = {
            \ 'css': 'vscode-css-language-server --stdio',
            \ 'html': 'vscode-html-language-serve --stdio',
            \ 'json': 'vscode-json-language-server --stdio',
            \ 'python': 'pyright-langserver --stdio',
            \ 'sh': 'bash-language-server start',
            \ 'toml': 'tombi lsp --offline --quiet',
            \ 'typescript': 'typescript-language-server --stdio',
            \ 'typescriptreact': 'typescript-language-server --stdio',
            \ 'vim': 'vim-language-server --stdio',
            \ 'yaml': 'yaml-language-server --stdio',
        \}
    Plug 'github/copilot.vim'
call plug#end()
colorscheme noctu
